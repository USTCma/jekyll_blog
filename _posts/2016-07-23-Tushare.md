---
title: Python股票接口
date: 2016-07-23 23:21:00
tags: [代码,接口,数据集]
categories: '代码'
description: 
---
今天推荐一个python的股票接口[tushare](http://tushare.waditu.com/)，当然，不仅仅只包含股票，你也可以用tushare来获取期权和电影信息。后续我打算用Django和tushare做点意思的东西。

## 简介

TuShare是一个免费、开源的python财经数据接口包。主要实现对股票等金融数据从数据采集、清洗加工到数据存储的过程，能够为金融分析人员提供快速、整洁、和多样的便于分析的数据，为他们在数据获取方面极大地减轻工作量，使他们更加专注于策略和模型的研究与实现上。考虑到Python pandas包在金融量化分析中体现出的优势，TuShare返回的绝大部分的数据格式都是pandas DataFrame类型，非常便于用pandas、NumPy、Matplotlib进行数据分析和可视化。

## 前提

* 安装Python

* 安装pandas

* 安装lxml

## 安装

``` python
pip install tushare
``` 


## 数据存储

数据存储模块主要是引导用户将数据保存在本地磁盘或数据库服务器上，便于后期的量化分析和回测使用，在以文件格式保存在电脑磁盘的方式上，调用的是pandas本身自带的方法，此处会罗列常用的参数和说明，另外，也会通过实例，展示操作的方法。在存入DataBase方面，也提供了简单的处理方式。

* 保存为csv格式

* 保存为Excel格式

* 保存为HDF5文件格式

* 保存为JSON格式

* 存入MySQL等关系型数据库

* 存入MongoDB数据库

这里详细说明一下我使用的mysql存储。

pandas提供了将数据便捷存入关系型数据库的方法，在新版的pandas中，主要是已sqlalchemy方式与数据建立连接，支持MySQL、Postgresql、Oracle、MS SQLServer、SQLite等主流数据库。本例以MySQL数据库为代表，展示将获取到的股票数据存入数据库的方法,其他类型数据库请参考sqlalchemy官网文档的create_engine部分。

调用方法：

``` python
from sqlalchemy import create_engine
import tushare as ts

df = ts.get_tick_data('600848', date='2016-07-22')
engine = create_engine('mysql://user:passwd@127.0.0.1/db_name?charset=utf8')

#存入数据库
df.to_sql('tick_data',engine)

#追加数据到现有表
df.to_sql('tick_data',engine,if_exists='append')
``` 


## 一些接口调用数据说明

### 交易数据

[交易类数据](http://tushare.waditu.com/trading.html)提供股票的交易行情数据，通过简单的接口调用可获取相应的DataFrame格式数据，主要包括以下类别：

#### 历史行情数据

调用方法：

``` python
import tushare as ts
ts.get_hist_data('600848') #一次性获取全部日k线数据
``` 

结果返回：

``` r        
date        open   high   close  low     volume       price_change    p_change                                                      
2016-07-22  19.41  20.80  19.96  18.82  138136.42          0.87      4.56   
2016-07-21  18.31  19.53  19.10  18.25  166732.31          0.63      3.41   
2016-07-20  18.17  18.73  18.47  18.09   63176.86          0.48      2.67   
2016-07-19  18.30  18.30  18.00  17.90   42691.51         -0.31     -1.69   
2016-07-18  18.00  18.52  18.31  18.00   59686.98         -0.01     -0.06   
```

#### 复权历史数据

获取历史复权数据，分为前复权和后复权数据，接口提供股票上市以来所有历史数据，默认为前复权。如果不设定开始和结束日期，则返回近一年的复权数据，获取个股首个上市日期，请参考以下方法：

``` python
df = ts.get_stock_basics()
date = df.ix['600848']['timeToMarket'] #上市日期YYYYMMDD
```

本接口还提供大盘指数的全部历史数据，调用时，请务必设定index参数为True,由于大盘指数不存在复权的问题，故可以忽略autype参数。

``` python
ts.get_h_data('002337') #前复权
ts.get_h_data('002337', autype='hfq') #后复权
ts.get_h_data('002337', autype=None) #不复权
ts.get_h_data('002337', start='2016-07-01', end='2016-07-22') #两个日期之间的前复权数据
ts.get_h_data('399106', index=True) #深圳综合指数
```

结果返回：

``` r
date         open   high  close    low    volume     amount                                             
2016-07-22   7.91   7.93   7.81   7.80   5693673   44736728
2016-07-21   7.97   8.00   7.93   7.88   7327245   58218191
2016-07-20   7.86   8.15   7.95   7.85  14004890  112215380
2016-07-19   7.89   7.90   7.88   7.74   5106471   39976819
2016-07-18   7.83   7.90   7.81   7.75   5542922   43364244
```

#### 实时行情数据

一次性获取当前交易所有股票的行情数据（如果是节假日，即为上一交易日）

``` python
import tushare as ts

ts.get_today_all()
```

#### 历史分笔数据

获取个股以往交易历史的分笔数据明细，通过分析分笔数据，可以大致判断资金的进出情况。在使用过程中，对于获取股票某一阶段的历史分笔数据，需要通过参入交易日参数并append到一个DataFrame或者直接append到本地同一个文件里。历史分笔接口只能获取当前交易日之前的数据，当日分笔历史数据请调用get_today_ticks()接口或者在当日18点后通过本接口获取。

调用方法：

``` python
import tushare as ts

df = ts.get_tick_data('600848',date='2016-07-22')
df.head(10)
```

结果返回：

``` r
       time     price  change   volume   amount type
0     15:00:00  19.98     --       0        0   买盘
1     15:00:00  19.98   0.02       0        0   买盘
2     14:59:57  19.96  -0.02      23    45908   卖盘
3     14:59:52  19.98  -0.01      40    80519   卖盘
4     14:59:46  19.99     --      11    21989   买盘
5     14:59:42  19.99   0.01      24    47975   买盘
```

#### 当日历史分笔

获取当前交易日（交易进行中使用）已经产生的分笔明细数据。

调用方法：

``` python
import tushare as ts

df = ts.get_today_ticks('601333')
df.head(10)
```

结果返回：

``` r
        time     price pchange  change  volume   amount type
0     11:30:07   5.77   -0.52    0.00     634   366372   买盘
1     11:29:57   5.77   -0.52    0.00     216   124632   买盘
2     11:29:52   5.77   -0.52    0.00     306   176562   买盘
3     11:29:42   5.77   -0.52    0.01     159    91766   买盘
4     11:29:37   5.76   -0.69    0.00     546   314496   卖盘
5     11:29:32   5.76   -0.69   -0.01     954   549504   卖盘
```

#### 大盘指数列表

获取大盘指数实时行情列表，以表格的形式展示大盘指数实时行情。

调用方法：

``` python
import tushare as ts

df = ts.get_index()
```

#### 大单交易数据

获取大单交易数据，默认为大于等于400手，数据来源于新浪财经。

调用方法：

``` python
import tushare as ts

df = ts.get_sina_dd('600848', date='2016-07-22') #默认400手
#df = ts.get_sina_dd('600848', date='2016-07-22', vol=500)  #指定大于等于500手的数据
``` 

结果显示：

``` r
      code  name      time  price  volume  preprice type
0   600848  上海临港  14:53:31  19.99   97300     19.97   买盘
1   600848  上海临港  14:46:20  20.05   49500     20.05   卖盘
2   600848  上海临港  14:45:40  20.05  104000     20.06   卖盘
3   600848  上海临港  14:30:03  20.00  100000     20.10   卖盘
4   600848  上海临港  13:54:58  20.10   49900     20.09   买盘
5   600848  上海临港  13:25:58  19.90   97112     19.93   卖盘
```
<br>

### 基本面数据

[基本面类数据](http://tushare.waditu.com/fundamental.html)提供所有股票的基本面情况，包括股本情况、业绩预告和业绩报告等。主要包括以下类别：

#### 沪深股票列表

调用方法：

``` python
import tushare as ts

ts.get_stock_basics()
```

``` r
code      name      industry   area    pe    outstanding  totals   totalAssets                                                            
600462   九有股份      元器件   深圳    0.00     53378.00   53378.00  3.798510e+04   
600275    武昌鱼     农业综合   湖北    0.00     50883.71   50883.71  3.666568e+04   
600228   昌九生化     化工原料   江西    0.00     24132.00   24132.00  5.270965e+04   
002248   华东数控     机床制造   山东    0.00     21305.00   30749.56  2.130728e+05   
601028   玉龙股份      钢加工   江苏   61.61     78302.57   78623.77  3.318698e+05   
``` 

#### 业绩预告

调用方法：

``` python
#获取2016年第2季度的业绩报表数据
ts.get_report_data(2016,2)
```

结果返回：

``` r
    code    name     eps    eps_yoy  bvps  roe    epcf   net_profits    profits_yoy
0   600498  烽火通信  0.37    12.12   NaN   5.52   NaN     38735.63        16.05   
1   002258  利尔化学  0.19   -56.56   NaN   5.40   NaN      9797.50        10.64   
2   002415  海康威视  0.43   -21.82   NaN  12.96   NaN    260684.65        18.14   
3   600750  江中药业  0.66    43.48   NaN   8.01   NaN     19656.89        41.16   
4   600680  上海普天  0.00   -33.33   NaN   0.13   NaN       161.14       -33.79   
5   002326  永太科技  0.14     0.00   NaN   5.76   NaN     11088.11         0.20  
```

#### 盈利能力数据

按年度、季度获取盈利能力数据,调用方法：

``` python
#获取2016年第2季度的盈利能力数据
ts.get_profit_data(2016,2)
```

结果返回：

``` r
    code    name     roe      net_profit_ratio   gross_profit_rate  net_profits
0   600338  西藏珠峰  31.21             40.63            63.5566     263.6152   
1   002517  恺英网络  24.08             19.00            60.0172     245.2146   
2   002714  牧原股份  23.34             46.94            51.3697    1072.4289   
3   002415  海康威视  13.64             20.77            40.0999    2606.8465   
4   600961  株冶集团   8.36              0.20             5.4272      11.7493   
5   601799  星宇股份   8.23             11.12            22.0732     172.4706   
```
#### 营运能力数据

按年度、季度获取营运能力数据

调用方法：

``` python
#获取2016年第2季度的营运能力数据
ts.get_operation_data(2016,2)
```

结果返回：

``` r
    code    name     arturnover   arturndays     inventory_turnover inventory_days
0   002517  恺英网络      3.5652    100.9761            139.4678          2.5812   
1   603199  九华旅游     25.2534     14.2555             14.8681         24.2129   
2   300364  中文在线      1.4455    249.0488             14.7011         24.4880   
3   601678  滨化股份     11.8691     30.3309              8.7379         41.1998   
4   000690  宝新能源      5.5691     64.6424              7.5402         47.7441   
5   002462   嘉事堂      1.4767    243.7868              4.4874         80.2246 
```

#### 成长能力数据

按年度、季度获取成长能力数据

调用方法：

``` python
#获取2016年第2季度的成长能力数据
ts.get_growth_data(2016,2)  
```

结果返回：

``` r
    code    name      mbrg       nprg        nav      targ       epsg 
0   002517  恺英网络  615.9891  5161.3085    67.9233  109.6485  1100.0000   
1   002714  牧原股份  103.0987  2189.9255   132.0078   79.5340  1970.0000   
2   000667  美好集团  101.7760   709.0826    10.5421   -4.0277   646.1538   
3   000705  浙江震元   13.3277   300.8742     3.7671    9.8199   255.4545   
4   002615   哈尔斯   55.1639   114.3417     7.8319   53.1717    50.0000   
5   002644  佛慈制药   10.4215    58.3358     4.1372   11.1532   -40.6000 
```

#### 偿债能力数据

调用方法：

``` python
#获取2016年第2季度的偿债能力数据
ts.get_debtpaying_data(2016,2) 
```

结果返回：

``` r
    code     name      currentratio  quickratio  cashratio    icratio
0   603969  银龙股份       14.9422     12.4706   354.1040     -390.8586   
1   603199  九华旅游        2.1856      2.1157   120.8399    -9749.0683   
2   600750  江中药业        3.6634      3.2409   143.6984    32974.1790   
3   603558  健盛集团        4.6917      3.9021    96.5174    10026.1337   
4   300101  振芯科技        6.3416      4.1552   148.6906    34827.4432   
5   002168  深圳惠程        4.5282      4.2946   357.2013      873.9302 
```

#### 现金流量数据

调用方法：

``` python
#获取2016年第2季度的现金流量数据
ts.get_cashflow_data(2016,2)  
```

结果返回：

``` r
    code     name     cf_sales  rateofreturn    cf_nm      cf_liabilities  
0   603558  健盛集团    0.5408        0.0754   2.1229          0.4722   
1   000892  星美联合    0.4839        0.3656      NaN          0.7346   
2   600750  江中药业    0.4403        0.1343   1.9501          0.9057   
3   000690  宝新能源    0.4296        0.0543   1.7692          0.1438   
4   002714  牧原股份    0.3280        0.0808   0.6987          0.1601   
5   603199  九华旅游    0.3215        0.0670   1.3801          0.6217  
```

## 写在最后

其他用法请查询[tuShare官网](http://tushare.waditu.com/)。最后，提醒大家，股市有风险，投资请谨慎。和金融的朋友探讨说，靠数据分析买股票，实际风险也是相当大的。